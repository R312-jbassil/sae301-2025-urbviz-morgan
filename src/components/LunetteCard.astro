---
import SvgGlasses from "./SvgGlasses.astro";

interface Materiau {
  id: string;
  libelle: string;
}

interface LunetteRecord {
  id: string;
  code_svg: string;
  date_creation: string;
  taille_verre: number;
  largeur_pont: number;
  IDutilisateur: string;
  materiau_monture: string;
  materiau_branche: string;
  expand?: {
    materiau_monture?: Materiau;
    materiau_branche?: Materiau;
  };
}

interface Props {
  lunette: LunetteRecord;
}

const { lunette } = Astro.props;

const monture = lunette.expand?.materiau_monture?.libelle ?? "—";
const branche = lunette.expand?.materiau_branche?.libelle ?? "—";
const created = lunette.date_creation ? new Date(lunette.date_creation) : undefined;
---
<article class="product-card">
  <div class="product-image-wrapper">
    <div>
      <SvgGlasses svgCode={lunette.code_svg} />
    </div>
  </div>
  <div class="p-6 space-y-3">
    <header class="flex items-start justify-between gap-2">
      <div>
        <h3 class="text-lg font-semibold">Modèle #{lunette.id.slice(0, 6)}</h3>
        {created && (
          <p class="text-xs text-[rgba(15,23,42,0.6)]">
            Créé le {created.toLocaleDateString("fr-FR", { day: "2-digit", month: "long" })}
          </p>
        )}
      </div>
      <span class="badge badge-primary">{lunette.taille_verre} mm</span>
    </header>
    <ul class="space-y-1 text-sm text-[rgba(15,23,42,0.7)]">
      <li>
        <strong>Pont :</strong> {lunette.largeur_pont} mm
      </li>
      <li>
        <strong>Monture :</strong> {monture}
      </li>
      <li>
        <strong>Branches :</strong> {branche}
      </li>
    </ul>
    {Astro.slots.has("actions") && (
      <div class="pt-3">
        <slot name="actions" />
      </div>
    )}
  </div>
</article>
